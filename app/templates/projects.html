{% extends 'base.html' %}

{% block title %} Projects {% endblock%}

{% block main %}
	<div class="container-fluid">

		<div>
			<div class="ms-auto mt-3">
				<h4>Projects</h4>
			</div>

			{% if messages %}
				{% for message in messages %}
					{% if message.tags == 'error' %}
						<div class="row justify-content-center">
							<div class="col-4 align-self-center alert alert-dismissible alert-danger text-center">
								<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
								{{ message|striptags }}
							</div>
						</div>
					
					{% else %}
						<div class="row justify-content-center">
							<div class="col-4 align-self-center alert alert-dismissible alert-success text-center">
								<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
								{{ message }}
							</div>
						</div>
					{% endif %}
				{% endfor %}
			{% endif %}


<!-- TRIGER CREATE PROJECT MODAL -->
			<button type="button" class="btn btn-outline-primary rounded-3 mt-2" data-bs-toggle="modal"
				data-bs-target="#staticBackdropProject">
				Create new project
			</button>

<!-- TABLE -->
			<div class="table-responsive mt-3 text-center w-auto">
				<table class="table">
					<thead>
						<tr>
							<th scope="col">#</th>
							<th><i class="bi bi-star-fill" style="font-size: 16px; color:grey"></i></th>
							<th scope="col">Name</th>
							<th scope="col">Key</th>
							<th scope="col">Type</th>
							<th scope="col">Date</th>
							<th scope="col">Time</th>
						</tr>
					</thead>
					<tbody>
						{% for project in page_obj %}
						<tr>
							<th scope="row">{{ forloop.counter }}</th>

							{% if project.starred %}
								<td><button type="button" class="btn star-table">
									<i class="fs-6 bi bi-star-fill" style="color: gold;"></i></button>
								</td>
							{% else %}
								<td><button type="button" class="btn star-table">
										<i class="fs-6 bi bi-star" style="color:grey;"></i>
									</button>
								</td>
							{% endif %}

							<td><a class="link-offset-2 link-dark link-offset-3-hover link-underline 
                                link-underline-opacity-0 link-underline-opacity-75-hover"
									href="{% url 'boards' project.id %}">{{ project.name }}</a></td>
									
							<td>{{ project.key }}</td>
							<td>{{ project.type }}</td>
							<td>{{ project.created.date }}</td>
							<td>{{ project.created.time }}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>

<!-- PAGINATION -->
			<nav aria-label="Page navigation">
				<ul class="pagination pagination-sm mb-0 justify-content-center">
					{% if page_obj.has_previous and page_obj.paginator.num_pages > 2 %}					
						<li class="page-item">
							<a href="?page={{ page_obj.previous_page_number }}" class="page-link">
								<span aria-hidden="true">&laquo;</span>
							</a>
						</li>					
					{% else %}
					{% endif %}
					
					{% for page_number in page_obj.paginator.page_range %}	

						{% if page_number == page_obj.number %}
							<li class="page-item active">
								<a href="?page={{ page_number }}" class="page-link">{{ page_number }}</a>
							</li>
						{% else %}
							<li class="page-item">
								<a href="?page={{ page_number }}" class="page-link">{{ page_number }}</a>
							</li>
						{% endif %}				

					{% endfor %}
					
					{% if page_obj.has_next and page_obj.paginator.num_pages > 2%}
						<li class="page-item">
							<a class="page-link" href="?page={{ page_obj.next_page_number }}">
								<span aria-hidden="true">&raquo;</span>
							</a>
						</li>			
					{% else %}
					{% endif %}
				</ul>
			</nav>
		</div>
	</div>


<!-- CREATE PROJECT MODAL -->
	<div class="modal fade" id="staticBackdropProject" data-bs-backdrop="static" tabindex="-1"
		aria-labelledby="staticBackdropProject" aria-hidden="true" data-backdrop="static">
		<div class="modal-dialog  modal-dialog-centered">
			<div class="modal-content">

				<div class="modal-header">
					<h1 class="modal-title fs-5 text-secondary" id="staticBackdropProject">Create project</h1>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>

				<div class="modal-body">
					<form action="{% url 'projects' %}" method="post">
						{% csrf_token %}
						{% for field in project_modal_form %}

							{% if field.name == "author" %}
								{{ field.as_hidden }}

							{% elif field.name == "starred" %}
								<div class="col-md-6 mb-4">
									<p class="text-secondary m-0 text-start">Favorite</p>
									{{ field }}
								</div>
							
							{% else %}
							<div class="col-md-6 mb-3">
								<p class="text-secondary m-0 text-start">{{ field.name|title }}*</p>
								{{ field }}
							</div>

							{% endif %}
						{% endfor %}

						<div class="modal-footer pb-0">
							<button type="submit" class="btn btn-primary">Create</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

{% endblock %}
